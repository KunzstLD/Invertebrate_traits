\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{hyperref}
\usepackage{float}
\usepackage[table,xcdraw]{xcolor}
\usepackage{color, colortbl}
\usepackage{longtable}
%\usepackage[sort&compress,square,comma,authoryear]{natbib}
\usepackage{booktabs}
\usepackage{graphicx}
\usepackage{multirow}
\usepackage{tikz}
% \graphicspath{{/home/kunz/Dokumente/Projects/Trait_DB/Invertebrate_traits/Paper/Figures/}}
\graphicspath{{Figures/}}
\usepackage{rotating}
\usepackage{geometry}
\usepackage{array}
\usepackage{lscape}
\usepackage{longtable}
\usepackage{hhline}
\usepackage{lmodern}
\usepackage[
backend = biber,
style = ieee,
citestyle = numeric-comp,
maxbibnames=99,
sorting = none % sort by name year title
]{biblatex}
\addbibresource{Ref_invertebrate_DB.bib}

\usepackage{subfiles} % Best loaded last in the preamble

% functions and definitions
\definecolor{Gray}{gray}{0.9}

% horizontal space between two columns
\setlength{\tabcolsep}{2mm}

\newcommand{\specialcell}[2][c]{%
  \begin{tabular}[#1]{@{}c@{}}#2\end{tabular}}

\renewcommand*{\thefootnote}{\alph{footnote}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{DRAFT: Harmonized and trait aggregation paper }
\author{}%Stefan Kunz 
\date{}

\begin{document}
\maketitle

\section*{Introduction}

Explaining and predicting how communities are shaped by environmental factors is one of the main goals of ecology. Species traits, defined as measurable properties of an organism \cite{mcgill_rebuilding_2006}, might be beneficial in achieving this goal \cite{heino_jani_macroecological_2013}. %?just traits 
Traits evolve through adaptations (e.g., physiological, behavioural, etc.) of organisms to their environment and indicate direct or indirect linkages between the biological response of an organism to its environment \cite{southwood_habitat_1977, verberk_delivering_2013}.
%%%%%%%%%%%%%%%%%%%%%%%%%%
% TODO: PUP: Not only „of an organism“, but also „of a population“ (at least for some of the traits related to reproduction; e.g. difficult to describe „voltinism“ as the organism scale!).
%%%%%%%%%%%%%%%%%%%%%%%%%%
Besides providing a mechanistic explanation of species-environment relationships, trait-based approaches might be suitable for large scale analysis because the variability in trait responses is lower than in taxonomic responses \cite{bonada_taxonomic_2007, baird_toward_2011}. Traits of freshwater invertebrate individuals are difficult to determine because - unlike plants - their traits often cannot be measured directly.
For example, to gain knowledge on feeding habits requires evaluating mouthpart morphology, consumed food, and the organisms function within its community \cite{moog_comprehensive_nodate}. 
%%%%%%%%%%%%%%%%%%%%%%%%%%
% PUP says: But the trait-based approach can benefit from two centuries of detailed, published observations on biological traits and ecological preferences made by zoologists/ecologists on a large range of species in various environmental conditions.
%%%%%%%%%%%%%%%%%%%%%%%%%%
Nevertheless, invertebrate traits have been increasingly used in freshwater ecology, e.g. by relating macroinvertebrate trait composition to environmental factors or as trait metrics in biomonitoring \cite{poff_developing_2010, szocs_effects_2014, bhowmik_large_2015, menezes_beyond_2010}.

In the last decades, freshwater ecologists developed comprehensive invertebrate trait databases for various continents \cite{usseglio-polatera_biomonitoring_2000, schmidt-kloiber_www.freshwaterecology.info_2015, vieira_database_nodate, Philips_and_Smith_NZ_DB_2018, kefford_integrated_2020, tomanova_trophic_2006}. The availability of invertebrate trait data from different continents enables comparisons of trait variation and their relation to environmental factors across large scales. However, such analyses have been carried out mostly within continents, using information from one or two trait databases. For example, Bonada et al. \cite{bonada_taxonomic_2007} compared trait composition for Mediterranean and temperate regions in Europe using traits from the Tachet database \cite{usseglio-polatera_biomonitoring_2000}, Poff et al. \cite{poff_developing_2010} characterized trait composition across sites in the Western US using traits from Poff et al. \cite{poff_functional_2006}, and Botwe et al. \cite{botwe_effects_2018} investigated the effect of salinity on invertebrate traits in different sites in South Australia using trait data from Poff et al. \cite{poff_functional_2006} and Schäfer et al. \cite{schafer_trait_2011}. Analyses of invertebrate traits that synthesize information on invertebrate grouping features from more than two different continents are rare. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% biogeographic regions substituted with continents
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PUP & ASK: So „grouping features“ are „traits“ (in most of the published databases) described by „traits“ (i.e. several „related categories“). 
% I agree that these definitions have to be made more clear, i.e. that you are using the term „grouping feature“ for what most published articles call “traits” and that what others call “categories” (within the traits) are your “traits”. Maybe add a “definition” of terms at the beginning ...also your use of “affinity” needs to be included there…
% Put into definitons of terms?
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
In this study, we follow the terminology proposed by Schmera et al., where a grouping feature is defined as a general property (e.g. feeding mode) that comprises a "group of related traits (e.g., predator, shredder, etc.) that vary among species or among individuals within a species" \cite{schmera_proposed_2015}. Thus, we use the term grouping feature in place of which many studies use the term "trait", and the term trait instead of "trait state", "modality" or "trait category". 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TODO: Description of affinity
% A trait can described using a binary coding (exists or not), or using affinity scores that indicate the which extent an organism expresses a certain trait.  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
To our knowledge, only Brown et al. \cite{brown_functional_2018} harmonized grouping features from more than two geographically distant invertebrate trait databases in a study on the influence of decreasing glacier cover on functional diversity and community assembly of invertebrates. 
% TODO: ?Paper trait convergence Doledec

We suspect that the heterogeneity of information in freshwater invertebrate trait databases, besides the diversity of taxa across regions, is likely a major reason for the lack of studies across continents. To harmonize grouping features from different regions, first commonly accepted and unambiguous trait definitions are required \cite{schneider_towards_2019}. In the best case, grouping features would be classified into the same traits across databases or they could easily be harmonized using standardized terminology. However, a lack of standardized terminology of trait definitions and poor metadata quality in many trait databases are common issues throughout the field of trait-based ecology \cite{baird_toward_2011, schneider_towards_2019}. Secondly, consistent coding of traits facilitates the compatibility of trait data from different databases. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% BK: I am not sure that the it is binary which is the defining issue, rather it is that there is no uncertainty. E.g. respiration type as more than two opitions but not undertainty into which a species fall into. 
% PUP: OK in your definition of „grouping features“ and „traits“, it is probably more the „trait description“ than the „trait“ (itself) which can be „binary“.
% ASK to Voltinism: I think this not an appropriate example for multiple categories except you include different regions for which different categories can apply; i.e. multivoltine in the temperate region and univoltine in the boreal region for the same species
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Alternative from Ben:
Traits can be described in a binary fashion with no uncertainty how the trait is expressed in any particularly organism (e.g. adult terrestrial stage, presence of gills), continuous (e.g. tolerance of pollution, body size) or using multiple descriptions (e.g. locomotion) with some uncertainty as to which trait the organism should be coded to. One approach for dealing with the uncertainty in the latter is the use of fuzzy coded variables. Fuzzy codes are used to account for plasticity in traits, variability in traits within taxonomic groups above species, and incomplete knowledge and are usually converted to proportions.

However, invertebrate trait databases are heterogeneous regarding the coding they use for their traits \cite{culp_incorporating_2011} 
%(Table \ref{tab:trait_databases_coding_differentiation}).
% TODO: Don't use table 5 and maybe find another reference?
Brown et al. \cite{brown_functional_2018} harmonized grouping features based on trait databases from Europe, North America, and New Zealand because in these trait databases identical grouping features are classified differently into traits. As the traits from North America were coded binary in contrast to the traits from Europe and New Zealand which have been established using affinity scores, the authors consulted experts to assign fuzzy coded traits to North American taxa or inferred them from the European trait database. Thus, it becomes apparent that using invertebrate trait data from several regions requires extensive data processing prior to the actual data analysis. A centralized database with standardized and unambiguous traits and a consistent coding of traits would minimize data processing effort.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PUP: Taking into account your definition of traits (= „trait categories“ or „trait modalities“ in Tachet et al., 2010) and grouping features (= „traits“ in Tachet et al., 2010), the fuzzy coding approach is not applied to the „trait“ scale, but to the „grouping feature“ scale. At the „trait“ scale, „only“ an affinity score is allocated to a given taxon. The binary/quantitative character of this score is probably not the only important criterion to consider. One of the major characteristics of the fuzzy coding approach is, at the „grouping feature“ scale, to allow several „traits“ to be simultaneously present (possibly with different affinity scores) in a given „grouping feature“ for a given taxon (i.e. a non-disjunctive approach).
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ASK: this is something that should not appear in the introduction, at least not in such detail…
% ASK: I would suggest not to use “higher/lower” as this is used in different ways in different publications (low can mean low (i.e. imprecise) identification level, but it also can mean low in terms of systematic hierarchy, which then would mean more precise id level…); I would suggest to use terms like precise/imprecise, accurate or the like…
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Differing taxonomic resolutions (e.g. species, genus or family) between the observed taxa in a study and the used trait database is another challenge when working with trait data. When observations are on a more precise taxonomic level than data available in the trait databases (e.g. observations on species-level, trait data on genus-level) trait information of the less precise taxonomic level is often assigned (e.g. \cite{szocs_effects_2014, vos_taxonomic_2017}). Conversely, if trait information is only available on more precise taxonomic levels than the observed taxa, traits are aggregated to a less precise taxonomic level, e.g. \cite{poff_functional_2006, szocs_effects_2014, piliere_a._f._h._importance_2016, aspin_extreme_2019}. Thereby, trait aggregation is often done using the mean \cite{magliozzi_functional_2019},
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PUP: Sometimes weighted by the rarity/commonality of individual taxa (e.g. genera) at large spatial scale (e.g. ecoregions), within the higher level taxonomic unit (e.g. family), because the probability of the commonest taxa to be present in a given sample is higher (at large spatial scale).
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
median \cite{szocs_effects_2014} or the mode \cite{piliere_a._f._h._importance_2016}. Up to now, studies on how and to which extent different trait aggregation methods influence trait-based analysis are missing. Knowing this can aid the choice of aggregation method for future studies.

We aimed to determine the influence of grouping feature harmonization and trait aggregation on trait-environment relationships. In particular, we aimed to (1) determine the effect of different harmonization methods using 4 invertebrate grouping feature datasets for seven grouping features from Europe, North America, New Zealand, and Australia. Furthermore, we (2) compared trait affinities obtained through different trait aggregation methods to trait affinities assigned at family-level by experts. We (3) re-analysed data on the effect of anthropogenic salinisation on biological traits by Szöcs et al. \cite{szocs_effects_2014} using harmonized grouping features and aggregated traits. By comparison with the original analysis, we investigated how harmonizing and aggregating trait data can modify the outcome of trait-environment relationships. Finally, we (4) present an overview of discrepancies in trait definition between the used invertebrate trait datasets and discuss challenges of trait data synthesis.

\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section*{Methods}

\subsection*{Selection of traits and harmonization of trait databases}

We extracted information from 6 trait databases from Europe, North America, Australia, and New Zealand and harmonized 7 grouping features. Trait information for Europe was obtained from the freshwaterecology.info database \cite{schmidt-kloiber_www.freshwaterecology.info_2015} and the Tachet database \cite{usseglio-polatera_biomonitoring_2000}. The freshwaterecology.info contains taxa on species-level, while taxa recorded in the Tachet database are on species, genus and family-level.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% freshwater.info requested from ASK
% Slightly changed - Comment from ASK: this is rather confusing at this stage as most of the assignments in freshwaterecology.info (fwe) are on species level whereas Tachet et al. have mostly genus and family level data in their database
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Trait information for North America was obtained from Twardochleb et al. \cite{twardochleb_trait_data_2020} and complemented by Vieira et al. \cite{vieira_database_nodate}. Data on body form for European and North American taxa was provided based on expert knowledge \cite{polatera_personal_information_2020}. For Australia and New Zealand, we used trait databases from Kefford et al. \cite{kefford_integrated_2020} and Philips and Smith respectively \cite{Philips_and_Smith_NZ_DB_2018}. To increase readability we refer to the databases as well as the datasets we extracted from them by the name of the continent they originate from. Excluded from this are the European databases, which we refer to by their commonly used names (freshwaterecology.info and Tachet database). 
% Eingefügt da die Bennung uneinheitlich im Manuskript war, auch von den Co-Autoren kritisiert wurde 

We selected traits of seven grouping features that were available in all databases, are commonly used, and describe different parts of the biology of a species: life history (Voltinism), morphology (Respiration, Body form, Size), ecology (Locomotion, Feeding mode) and reproduction (Oviposition). We omitted ecological traits that describe habitat preferences (e.g. temperature preference) because these traits are missing in the New Zealand trait database. The grouping features were differently classified across the databases, we therefore harmonized them into 26 traits (Table \ref{tab:traits_harmonization}). Harmonization was undertaken by amalgamating similar traits into one trait (e.g. crawlers and sprawlers into crawlers).
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Does it mean that the relative frequency of „non-amalgamated“ traits could be modified in the „grouping feature“ profiles of taxa? (because the highest score could be lower than the sum of the affinity scores of the amalgamated traits)
Thereby, for a particular taxa the highest trait affinity score among the amalgamated traits was taken. 

We used fuzzy coded traits for establishing our harmonized datasets unless data quality prohibited. In the latter case we used binary traits, i.e. categorical and continuous traits were converted into binary traits. For example, in the  freshwaterecology.info database taxa were classified according to different floristic regions for the trait voltinism. Hence, the entries of the voltinism traits such as "arctic" or "boreal" were substituted with a value of 1. Implicitly, we assumed for binary traits that a value of 1 corresponds to the highest affinity for a particular trait and 0 to no affinity for a particular trait. Fuzzy codes are reported with different ranges in the trait databases (e.g. freshwaterecology.info 0 to 10, Tachet database 0 to 3 or 0 to 5). We standardized them to a range between 0 and 1 and converted trait affinities to percentages. Thus, fuzzy coded and binary traits were in the same range. 

Prior to harmonization we consolidated duplicate taxa on species, genus or family-level if present, by either applying the median for fuzzy coded traits, or the maximum for binary traits. We omitted taxa with a less precise taxonomic resolution than family-level.

\begin{table}[H]
\centering
\caption{Traits of the harmonized grouping features. The last column indicates traits that were amalgamated for harmonization (no amalgamation needed if empty).}
\label{tab:traits_harmonization}
\begin{tabular}{lll}
\toprule[.1em]
Grouping feature & Trait & Amalgamated traits\\
\toprule[.1em]
Voltinism    & \begin{tabular}[c]{@{}l@{}}Semivoltine\\ Univoltine\\ Bi/multivoltine\end{tabular}                                & \begin{tabular}[c]{@{}l@{}}\textless 1 generation per year\\ 1 generation per year\\ \textgreater 1 generation per year\end{tabular}                                                                                                                                            \\
\midrule
Body Form    & \begin{tabular}[c]{@{}l@{}}Cylindrical \\ Flattenend\\ Spherical\\ Streamlined\end{tabular}                       & \begin{tabular}[c]{@{}l@{}}Cylindrical, tubular\\ Flattend, dorsoventrally flattened \textsuperscript{\textit{a}}\\ Spherical, round (humped)\\ Streamlined, fusiform\end{tabular}                                                                                                                                                                          \\
\midrule
Size         & \begin{tabular}[c]{@{}l@{}}Small \\ Medium \\ Large\end{tabular}                                                  & \begin{tabular}[c]{@{}l@{}}\textless 9 mm, \textless 10 mm \textsuperscript{\textit{b}}\\ 9 - 16 mm, 10 - 20 mm\\ \textgreater 16 mm, \textgreater 20 mm\end{tabular}                                                                                                                \\
\midrule
Respiration  & \begin{tabular}[c]{@{}l@{}}Gills\\ Plastron/Spiracle\\ \\ \\ Tegument\end{tabular}                             & \begin{tabular}[c]{@{}l@{}}Temporary air store, tracheal gills, gills\\ Spiracular gills, atmospheric breathers, \\ plant breathers, functional spiracles, \\ air (plants), aerial, plastron/spiracle\\ Cutaneous, tegument \end{tabular}                                                                         \\
\midrule
Locomotion   & \begin{tabular}[c]{@{}l@{}}Burrower\\ Crawler\\ Sessil\\ Swimmer \end{tabular}                                     & \begin{tabular}[c]{@{}l@{}}Interstitial, boring, burrowing\\ Sprawler, walking, climber, clinger, crawler\\ Attached, sessil\\ Skating, diving, planctonic, swimming\end{tabular}                                                                                                                 \\
\midrule
Feeding mode & \begin{tabular}[c]{@{}l@{}}Filterer\\ \\ Gatherer\\ \\ Herbivore\\ \\ Parasite\\ Predator\\ Shredder \\ \\ \end{tabular} & \begin{tabular}[c]{@{}l@{}}Active/passive filterer, absorber, \\ filter-feeder, collector-filterer, filterer\\ Deposit-feeder, collector-gatherer, \\ detrivore, gatherer\\ Grazer, scraper, piercer herbivore, \\ herbivore, algal piercer, piercer (plants)\textsuperscript{\textit{c}}\\ \\ Piercer (animals)\textsuperscript{\textit{c}}, predator \\ Miner, xylophagus, shredder, \\ shredder detrivore\end{tabular} \\
\hline
Oviposition  & \begin{tabular}[c]{@{}l@{}}Aquatic eggs\\ \\ Ovoviviparity\\ Terrestrial eggs\end{tabular}                            & \begin{tabular}[c]{@{}l@{}}Eggs attached to substrate/plants/stones,\\ free/fixed eggs/clutches\\ \\ Terrestrial clutches, terrestrial \end{tabular}     \\
\bottomrule[.1em]
\end{tabular}
\end{table}
\begin{minipage}{\linewidth}{\fontsize{8}{10}\selectfont
    \textit{a} The trait "bluff (blocky)" occurred in the Vieira et al. \cite{vieira_database_nodate} database and was newly classified by expert knowledge into cylindrical and flattened \cite{polatera_personal_information_2020}. \\  
    \textit{b} Reflects the different size classifications by the North American trait databases and the other trait databases. \\
    \textit{c} The trait piercer was defined in the Tachet database for piercing plants and animals, in contrast to the other databases \cite{usseglio-polatera_biomonitoring_2000}. Taxa exhibiting this trait have been assigned to predators or herbivores based on expert knowledge \cite{polatera_personal_information_piercer_2020}.
}
\end{minipage}

\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection*{Trait aggregation}

Traits of the harmonized grouping feature datasets were aggregated to family-level using three approaches. I) Direct aggregation of taxa to family-level giving equal weight to every taxon using the mean or median, denoted \textit{direct\_agg\textsubscript{mean}} and \textit{direct\_agg\textsubscript{median}}, respectively. II) Stepwise aggregation, i.e. first to the genus-level and subsequently to the family-level using the mean or median. This approach gives equal weights to each genus. Hereafter, we denote this aggregation type as \textit{stepwise\_agg\textsubscript{mean}} or \textit{stepwise\_agg\textsubscript{median}}, respectively. III) Aggregation using a weighted mean approach, denoted as \textit{weighted\_agg}. This method weights the genera according to the number of their species in the trait datasets regardless if for every used grouping feature information was available. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PUP: Is it the „potential number of species“ (i.e. the number of species potentially present at the selected spatial scale) or the number of species with traits/grouping features described? The grouping feature information can be available for a different set of species from a grouping feature to another. Does it mean that genus weights can be different in the aggregated family profile according to the information available on traits (regardless of the actual number of species in these different genera?
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% BK:
% # I wonder if some simulation could be useful to determine in what
% # circumstances the different aggregation methods will produce similar
% # or different results. E.g. If all families were to have the same number of
% # genus and all genus the same number of species (something which would
% #  never happen),
% # then it will not matter (much) whether direct, stepwise or
% # weighted aggregation is used.
% # It only becomes important if direct, stepwise or weighted is used,
% # as the number of genus per family and/or species per genus differ.
% # Some simulation that varies the taxonomic hierarchy and variability in traits
% # between genus within a family and species within genus, ….,

To examine the influence of the taxonomic hierarchy and the trait variability on the outcome of the different trait aggregation methods we simulated three different taxonomic hierarchies. 
Sim1) A family with equal number of genera and species (5 genera each with 5 species respectively).
Sim2) A family were one genus has a much larger number of species as the other 4 genera (1 genus with 13 species, 4 genera with 3 species respectively). 
Sim3) A family were all genera have a different number of species (8, 2, 7, 3, 5)
Every simulated taxonomic hierarchy was assigned a hypothetical grouping feature with 3 traits. The individual affinities for each trait were sampled from a truncated normal distribution with a mean value of 0.5 and 5 levels of standard deviation (0.2, 0.4, 0.6, 0.8 and 1) respectively to simulate trait variability. The truncated normal distribution was bound to 0 and 1. The traits were normalized so that they sum up to one for each species, similar to the data processing of the trait databases. 100 Simulations for each standard deviation were carried out. Hence, 
500 simulations were run for each simulation scenario (in total 1500). 
All trait aggregation methods were applied to each simulated dataset and the results were compared.   
% Sampled from a truncated normal distribution values for three traits
% (upper and lower boundaries 0 and 1)
% Traits were normalized so that they sum up to one
% Three different taxonomic hierarchies were simulated: 
% Simulated one family with 25 species 
% -> 1) 5 Genera:  5 Species respectively
% -> 2) 5 Genera: 1 Genus 13 Species (more than ~ 50 %); 4 Genera with 3 species
% -> 3) 5 Genera: All have different amount of species


\begin{figure}
  \centering
  \subfile{Flowchart/Flowchart_methods.tex}
  \caption{Data processing steps of the selected traits. Intermediate (gray) and main (orange) steps of data preparation are depicted. The dashed bottom box illustrates the different trait aggregation methods using a small made-up example (data in the upper left corner). The aggregation methods (blue) and intermediate steps of the aggregation methods (purple) are displayed. Abbreviations: EU: Europe, NOA: North America, AUS: Australia, NZ: New Zealand, DB: Database.}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PUP: 
% Difficult to understand, with your example, what has been done based on your description of the calculation.
% If you have allocated a weight of „3“ to each species of G1 (as indicated in your detailed calculation; i.e. 0,25*3 + 0.5*3 + ...), the final contribution of G1 will be nine times greater than that of a genus only described by a single species (not really consistent).

% In my opinion (and taking into account your rationale when defining the other strategies), it would have been more coherent to allocate (i) a weight of „3“ to the mean score of G1 (because 3 species from this genus), (ii) a weight of „2“ (not „1“) to the mean score of G2 (because two descriptions : sp4 and genus sp. or spp.  ... even if we can question the relevance of averaging information that is at least partially redundant) and a weight of „1“ to the family score (idem, this information is at least partially redundant with the information provided by genera G1 and G2).

% Response: Weight of 2 is thinkable! However, disagree with PUP because what he proposes is basically the direct aggregation using the mean. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection*{Comparison of family-level aggregated traits with family-level assigned traits}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ASK: I would change the heading; basically it is comparing family-level-aggregated traits to family-level assigned traits… both, the formerly species-level traits as well as the family-level traits were assigned by experts…. the point are not the experts but the level of assignment…

% btw. did you try to compare this on genus level as well, e.g. the aggregated genus-level traits from fwe to the assigned genus-level traits from f et al.; this would be highly interesting!
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Aggregated trait affinities of the five trait aggregation methods (\textit{direct\_agg\textsubscript{median}}, \textit{direct\_agg\textsubscript{mean}}, \textit{stepwise\_agg\textsubscript{median}}, \textit{stepwise\_agg\textsubscript{mean}}, and \textit{weighted\_agg}) were compared to trait affinities assigned at family-level by experts, which were available for Australia and North America for a subset of grouping features and taxa. For the Australian dataset, we compared aggregated trait affinities with assigned trait affinities resolved at family-level for the grouping features feeding mode and size using data from Chessman et al. \cite{chessman_dissolved-oxygen_2018}. In Chessman et al. \cite{chessman_dissolved-oxygen_2018} feeding mode is classified similarly as in the Australian dataset except that the trait parasite is missing. We conducted the comparison for the 220 families available in Chessman et al. \cite{chessman_dissolved-oxygen_2018}. Considering each factor combination of family and trait (in total 8) this amounts to 1760 cases.

For the North American dataset, we compared aggregated trait affinities with assigned trait affinities on family-level for the grouping features feeding mode, respiration, size, voltinism, and locomotion. The assigned trait affinities at family-level are part of the North American database (Twardochleb et al.) \cite{twardochleb_trait_data_2020} and originate from expert knowledge. Trait information was available for 94 families of which all were present in the North American dataset (total number of cases 1598). The traits were on the categorical scale and were converted to binary traits prior to the comparison with aggregated trait affinities.

As mentioned above, trait affinities ranged from 0 to 1. Hence, the maximum difference possible in trait affinities is 1 or -1 (corresponds to 100 \%). For convenience and to improve interpretation, we report absolute trait differences.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection*{Analysis of the effect of harmonization and trait aggregation on trait-environment relationships}

We repeated the analysis of Szöcs et al. \cite{szocs_effects_2014} who studied the effect of anthropogenic salinization on invertebrates in the River Werra in Germany. For the re-analysis we used the established harmonized grouping features for Europe and additionally aggregated traits using the aforementioned aggregation methods. 

The river Werra has been subject to effluents from the potash industry since the mid of the 20th century and allows to study responses of invertebrates and their trait compositions to salinization \cite{bathe_biological_2011}.
% BK : Want to add some general refs about salinization and salinization on this river. 
Sites downstream, upstream, and close to the salt discharge (transition) were compared regarding their trait composition. Further details can be found in Szöcs et al. \cite{szocs_effects_2014}. 

We substituted 6 of the grouping features from the original data with harmonized grouping features from the European trait dataset. We compared the results of the redundancy analysis (RDA) from the original study to the case when using harmonized grouping features. Specifically, the trait composition expressed as community weighted mean (CWM) traits was ordinated along an electric conductivity gradient. We compared the species scores obtained from the RDA, i.e. the coordinates of the tips of the vectors representing the CWM traits in the bi- or triplots. For our analysis, we used the same 21 grouping features that Szöcs et al. \cite{szocs_effects_2014} used. The 6 harmonized grouping features used were \textit{Size, Feeding mode, Locomotion, Oviposition, Respiration}, and \textit{Voltinism}. %Traits of those grouping features responded strongly to salinity in the study of \cite{szocs_effects_2014}. 
Additionally, for testing the effect of aggregated traits we assigned to each taxon in Szöcs et al. \cite{szocs_effects_2014} the aggregated trait value for its corresponding family and repeated the RDA.  
% ? reference to SI

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection*{Data analysis}

The data processing and aforementioned analysis were carried out using R (Version 3.6.1 and 4.0.3). Raw data and the R code for data processing and grouping feature harmonization is located in the Github repository: \url{https://github.com/KunzstLD/Invertebrate_traits}. Scripts and data to reproduce the trait aggregation and analysis with aggregated traits are located in the Github repository \url{https://github.com/KunzstLD/Trait-aggregation}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\section*{Results}

%! Completeness of trait information and taxonomical coverage
\subfile{Results/Taxonomic_cov_and_info_compl}

\newpage 
%! Comparison of trait aggregation methods
\subfile{Results/Results_trait_agg}

\newpage 

%! Presenting results of trait analysis using harmonized traits:
\subfile{Results/Results_trait_harmonization}
% TODO: Fix reference to SI!

\newpage 

%! Discrepancies in trait definitions
% ?(Discuss history of trait values)
\subfile{Trait_def_table/Trait_definitions_table}

\section*{Discussion}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 1) Trait aggr methods vs assigned traits:
% - BK:
%  All range from about 0 to 1 and all have mean values which fall within the error bars (stand dev) of the other methods. 
% Figure 3, however, does suggest some differences in terms of range, with the methods which use median have narrow ranges. In terms of mean values perhaps more difference than for the Australian analysis but even still considering the +/- the error bars I think they all overlap.
% It then becomes what to make of all this. Are the slight differences between the methods important or unimportant?
% Also why the differences between the Australian and NA datasets?


% 2) Influence of aggregation methods on trait-environment relationships:
% - In general, differences produced by the aggregation methods seem to arise by using mean or median, 
% not driven by different weighting approaches (direct vs. stepwise vs. weighted) 
% -> link to taxonomic hierarchy, many families have only a few genera
% -> Similarly, many genera have only a few species
% -> linear relationship: the more genus per family, the more species (although there are exceptions -> e.g. Europe)
% 
% Differences for NOA greater due to coding?

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Ben's Comment: -> But another issues is that these aggregation methods were being compared to traits assigned at the family level, which I understand was often done by expert opinion. So, these traits assigned at the family level may not be really “correct”! The difference between the trait aggregated to family and its designation at the family level could indicate: (a) the aggregation method is “no good”, (b) the trait assigned at the family level was “no good”, or (c) both a and b.

% Simulation result: 
% -  base simulation with similar amount of species per genus and genera per family and varying trait values
% results can vary when variation in trait values increases 
% However, mostly the different aggregation methods result in similar trait affinities
% when differences occur, only for: 
% dir_median vs stepwise median
% direct mean vs stepwise median
% stepwise mean vs stepwise median
% direct mean vs direct median
% stepwise median vs weighed agg
% Trait variability: 0.3 and greater
% Max diff ~ 0.2

% - Results for varying taxonomic hierarchy:
% Which levels?
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% 2) Harmonization: Minor influence on RDA species scores
% RDA species scores 
%   -> Normalized eigenvectors
%   -> dependent on nr. of variables? Nr. of response variables not really influential 
% We used only a small-scale study -> What's different to large-scale studies?
% Further aggr. after harmonization: no difference to the harmonized dataset
% ?Logical because trait aggr. methods themselves showed only minor differences
% Complex Stat. techniques developed -> cannot use full potential

% Suggestions from Co-Authors:
% should include where the classifications come from
% what do we really know because someone has watched the animals and published their behaviour; what is extrapolated knowledge?
% are the differences between continents because of evolution or only because scientists have done more research in one of the continents?

\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%% Bibliography %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\printbibliography

\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%% Supporting information %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{table}{0}
\setcounter{figure}{0}

\subfile{Results/SI}

\end{document}